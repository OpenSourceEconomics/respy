language:
    - python

python:
    - 3.6

before_install:
    - sudo apt-get update

addons:
    apt:
        packages:
            - gfortran
            - libatlas-dev
            - libatlas-base-dev

matrix:
    include:
        - env: CI_FORTRAN=False CI_MPI=False  CI_OMP=False
        - env: CI_FORTRAN=True CI_MPI=True  CI_OMP=True
        - env: CI_FORTRAN=True CI_MPI=False CI_OMP=True
        - env: CI_FORTRAN=True CI_MPI=True  CI_OMP=False

install:
    - sudo apt-get install -y -q mpich libmpich-dev

    # Install, configure conda and install packages
    - bash install_miniconda.sh
    - conda env create -n respy -f environment.yml
    - source activate respy

    # Install respy
    - pip install -e . -vv

script:
    - travis_wait 45 pytest --cov=respy -vvv -s

after_success:
-   if  [ $CI_FORTRAN ] || \
        [ $CI_MPI ] || \
        [ $CI_OMP ] ||
    then
        codecov
        echo 'send coverage statistic'
    fi

notifications:

  slack:
    rooms:
      - oseconomics:NwY0nlxNsQh1WTEs7Y1acukS
    on_success: change # default: always
    on_failure: always # default: always

  email: false
