language:
    - python

python:
    - 3.6

before_install:
    - sudo apt-get update

addons:
    apt:
        packages:
            - gfortran
            - libatlas-dev
            - libatlas-base-dev

matrix:
    include:
        - env: CI_FORTRAN=False CI_MPI=False  CI_OMP=False
        - env: CI_FORTRAN=True CI_MPI=True  CI_OMP=True
        - env: CI_FORTRAN=True CI_MPI=False CI_OMP=True
        - env: CI_FORTRAN=True CI_MPI=True  CI_OMP=False

install:
    - sudo apt-get install -y -q mpich libmpich-dev
    - bash install_miniconda.sh

    # Configure conda and install packages
    - conda config --set always_yes yes --set changeps1 no
    - conda info -a
    - conda install numpy scipy=0.19 pandas=0.21 statsmodels=0.8 numba

    - pip install -e . -vv
    - pip install pytest pytest-cov codecov

script:
    - travis_wait 45 pytest --cov=respy -vvv -s

after_success:
-   if  [ $CI_FORTRAN ] || \
        [ $CI_MPI ] || \
        [ $CI_OMP ] ||
    then
        codecov
        echo 'send coverage statistic'
    fi

notifications:

  slack:
    rooms:
      - oseconomics:NwY0nlxNsQh1WTEs7Y1acukS
    on_success: change # default: always
    on_failure: always # default: always

  email: false

# We only want to build with Travis when pushing to master or PR:
# https://stackoverflow.com/questions/31882306/how-to-configure-travis-ci-to-
# build-pull-requests-merges-to-master-w-o-redunda/31882307#31882307
branches:
  only:
    - master
